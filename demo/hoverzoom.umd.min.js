!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).HoverZoom=t()}(this,function(){"use strict";return class{constructor(e={}){const t={classNames:{container:"hoverzoom",image:"hoverzoom-image",zoomedImage:"hoverzoom-zoom",magnifier:"hoverzoom-magnifier",magnifierRound:"hoverzoom-magnifier--round",magnifierImage:"hoverzoom-magnifier--image"},position:"right",type:"outside",largeImage:"",blur:!1,grayscale:!1,throttleDelay:16};this.options={...t,...e,classNames:{...t.classNames,...e.classNames||{}}},this.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||void 0!==window.safari&&window.safari.pushNotification).toString(),this.domCache=new Map,this.rafId=null,this.lastCall=0,this.imageCache=new Map}throttle(e,t){return(...i)=>{const s=Date.now();s-this.lastCall>=t&&(this.lastCall=s,e.apply(this,i))}}cacheElement(e,t){return this.domCache.has(e)||this.domCache.set(e,t),this.domCache.get(e)}preloadImage(e){return this.imageCache.has(e)?Promise.resolve(this.imageCache.get(e)):new Promise((t,i)=>{const s=new Image;s.onload=()=>{this.imageCache.set(e,s),t(s)},s.onerror=i,s.src=e})}init(){const e=document.getElementsByClassName(this.options.classNames.container);for(let t=0;t<e.length;t++)this.iteration=t,this.currentContainer=e[t],this.applyHoverZoom()}applyHoverZoom(){const{image:e}=this.options.classNames;this.currentImageEl=this.currentContainer.querySelector(`.${e}`),this.currentImageEl.setAttribute("id",`${e}-${this.iteration}`),this.cacheElement(`image-${this.iteration}`,this.currentImageEl),this.options.largeImage=this.currentImageEl.dataset.largeImage?this.currentImageEl.dataset.largeImage:this.currentImageEl.src,this.preloadImage(this.options.largeImage).catch(()=>{console.warn("Failed to preload image:",this.options.largeImage)});"outside"===(this.currentImageEl.dataset.type||this.options.type)?this.outsideZoom():this.insideZoom(),this.addMouseListener()}outsideZoom(){const{zoomedImage:e,magnifier:t,magnifierImage:i}=this.options.classNames;this.zoomedElement=document.createElement("DIV"),this.zoomedElement.classList.add(e),this.zoomedElement.setAttribute("id",`${e}-${this.iteration}`),this.zoomedElement.style.setProperty("background-image",`url('${this.options.largeImage}')`);const s=this.currentImageEl.offsetWidth,a=this.currentImageEl.offsetHeight;this.zoomedElement.style.setProperty("background-size",`${4*s}px ${4*a}px`);const o=this.currentImageEl.dataset.position||this.options.position;this.currentContainer.style.setProperty("flex-direction","right"===o?"row":"column"),this.attachZoomedImage(),this.magnifierElement=document.createElement("DIV"),this.magnifierElement.classList.add(t),this.magnifierElement.setAttribute("id",`${t}-${this.iteration}`),this.magnifierImageElement=document.createElement("IMG"),this.magnifierImageElement.classList.add(i),this.magnifierImageElement.setAttribute("id",`${i}-${this.iteration}`),this.magnifierImageElement.setAttribute("src",this.options.largeImage),this.magnifierImageElement.style.setProperty("height",`${a}px`),this.magnifierImageElement.style.setProperty("width",`${s}px`),this.magnifierElement.appendChild(this.magnifierImageElement),this.currentContainer.appendChild(this.magnifierElement),this.cacheElement(`zoomed-${this.iteration}`,this.zoomedElement),this.cacheElement(`magnifier-${this.iteration}`,this.magnifierElement),this.cacheElement(`magnifier-image-${this.iteration}`,this.magnifierImageElement);const n=this.magnifierElement.offsetHeight*s/a;this.magnifierElement.style.setProperty("width",`${n}px`)}attachZoomedImage(){this.zoomedElement.style.setProperty("height",`${this.currentImageEl.offsetHeight}px`),this.zoomedElement.style.setProperty("width",`${this.currentImageEl.offsetWidth}px`);"right"===(this.currentImageEl.dataset.position||this.options.position)?this.zoomedElement.style.setProperty("margin-left","6px"):this.zoomedElement.style.setProperty("margin-top","6px"),this.currentContainer.appendChild(this.zoomedElement)}insideZoom(){const{magnifier:e,magnifierImage:t,magnifierRound:i}=this.options.classNames;this.magnifierElement=document.createElement("DIV"),this.magnifierElement.classList.add(e),this.magnifierElement.classList.add(i),this.magnifierElement.setAttribute("id",`${e}-${this.iteration}`),this.magnifierImageElement=document.createElement("DIV"),this.magnifierImageElement.classList.add(t),this.magnifierImageElement.setAttribute("id",`${t}-${this.iteration}`),this.magnifierImageElement.style.setProperty("background-image",`url('${this.options.largeImage}')`);const s=this.currentImageEl.offsetWidth,a=this.currentImageEl.offsetHeight;this.magnifierImageElement.style.setProperty("background-size",`${4*s}px ${4*a}px`),this.magnifierImageElement.style.setProperty("height",`${a}px`),this.magnifierImageElement.style.setProperty("width",`${s}px`),this.magnifierElement.appendChild(this.magnifierImageElement),this.currentContainer.appendChild(this.magnifierElement),this.cacheElement(`magnifier-${this.iteration}`,this.magnifierElement),this.cacheElement(`magnifier-image-${this.iteration}`,this.magnifierImageElement)}addMouseListener(){const{image:e,magnifier:t,magnifierImage:i,zoomedImage:s}=this.options.classNames,a=this.domCache.get(`magnifier-image-${this.iteration}`)||document.getElementById(`${i}-${this.iteration}`),o=this.domCache.get(`magnifier-${this.iteration}`)||document.getElementById(`${t}-${this.iteration}`),n=this.domCache.get(`zoomed-${this.iteration}`)||document.getElementById(`${s}-${this.iteration}`),r=this.domCache.get(`image-${this.iteration}`)||document.getElementById(`${e}-${this.iteration}`),{offsetHeight:m,offsetWidth:h}=o,l=r.dataset.type||this.options.type,g=.5*h,d="outside"===l?-.52*m:-.51*m,c=h/2-1,f=m/2;let p="opacity(0.8)";(r.dataset.blur||this.options.blur)&&(p+=" blur(2px)"),(r.dataset.grayscale||this.options.grayscale)&&(p+=" grayscale(100%)");const u=this.throttle(e=>{this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{r.style.setProperty("filter",p),o.style.setProperty("opacity","1"),"outside"===l&&n.style.setProperty("opacity","1");const t=e.offsetX?e.offsetX:e.pageX-r.offsetLeft,i=e.offsetY?e.offsetY:e.pageY-r.offsetTop;"outside"===l?n.style.setProperty("background-position",`${3*-t}px ${3*-i}px`):a.style.setProperty("background-position",`${3*-t}px ${3*-i}px`),o.style.setProperty("transform",`translate3d(${e.offsetX-g}px, ${e.offsetY+d}px, 0)`),a.style.setProperty("transform",`translate3d(${-e.offsetX+c}px, ${-e.offsetY+f}px, 0)`)})},this.options.throttleDelay);this.currentImageEl.addEventListener("mousemove",u),this.currentImageEl.addEventListener("mouseout",()=>{this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),r.style.setProperty("filter","unset"),o.style.setProperty("opacity","0"),"outside"===l&&n.style.setProperty("opacity","0")})}destroy(){this.rafId&&cancelAnimationFrame(this.rafId),this.domCache.clear(),this.imageCache.clear()}}});